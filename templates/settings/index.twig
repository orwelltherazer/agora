{% extends 'layouts/admin.twig' %}

{% block title %}Paramètres{% endblock %}
{% block page_title %}Paramètres de l'application{% endblock %}

{% block content %}

<div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
    <!-- Onglets -->
    <div class="border-b border-gray-200">
        <nav class="flex -mb-px" aria-label="Tabs">
            {% set categories = settingsByCategory|keys %}
            {% for category in categories %}
            <button type="button"
                    data-tab="{{ category }}"
                    class="tab-button whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm transition-colors
                           {% if loop.first %}border-indigo-600 text-indigo-600{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %}">
                <i class="fas
                    {% if category == 'application' %}fa-cog
                    {% elseif category == 'securite' %}fa-shield-alt
                    {% elseif category == 'fichiers' %}fa-file-alt
                    {% elseif category == 'pagination' %}fa-list
                    {% elseif category == 'notifications' %}fa-bell
                    {% elseif category == 'validation' %}fa-check-circle
                    {% elseif category == 'email' %}fa-envelope
                    {% else %}fa-wrench
                    {% endif %} mr-2"></i>
                {{ categoryLabels[category] ?? category|title }}
            </button>
            {% endfor %}
        </nav>
    </div>

    <form method="POST" action="{{ url('settings/update') }}">
        <!-- Contenu des onglets -->
        {% for category, settings in settingsByCategory %}
        <div class="tab-content {% if not loop.first %}hidden{% endif %}" data-tab-content="{{ category }}">
            <div class="divide-y divide-gray-200">
                {% for setting in settings %}
                <div class="p-6">
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                            <label for="setting_{{ setting.id }}" class="block text-sm font-medium text-gray-900 mb-1">
                                {{ setting.cle|replace({'_': ' ',
                                                         'app ': '',
                                                         'email ': '',
                                                         'validation ': '',
                                                         'upload ': '',
                                                         'session ': '',
                                                         'pagination ': '',
                                                         'notif ': ''})|title }}
                            </label>
                            {% if setting.description %}
                            <p class="text-sm text-gray-500">{{ setting.description }}</p>
                            {% endif %}
                        </div>
                        <div class="w-80">
                            {% if setting.type == 'boolean' %}
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox"
                                       id="setting_{{ setting.id }}"
                                       name="setting_{{ setting.id }}"
                                       value="1"
                                       {{ setting.valeur == '1' ? 'checked' : '' }}
                                       class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <span class="ml-2 text-sm text-gray-700">Activé</span>
                            </label>

                            {% elseif setting.type == 'integer' %}
                            <input type="number"
                                   id="setting_{{ setting.id }}"
                                   name="setting_{{ setting.id }}"
                                   value="{{ setting.valeur }}"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">

                            {% elseif setting.type == 'password' %}
                            <input type="password"
                                   id="setting_{{ setting.id }}"
                                   name="setting_{{ setting.id }}"
                                   value="{{ setting.valeur }}"
                                   placeholder="••••••••"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">

                            {% else %}
                            <input type="text"
                                   id="setting_{{ setting.id }}"
                                   name="setting_{{ setting.id }}"
                                   value="{{ setting.valeur }}"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        <!-- Bouton de sauvegarde -->
        <div class="bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200">
            <div class="text-sm text-gray-500">
                <i class="fas fa-info-circle mr-1"></i> Les modifications sont appliquées immédiatement après enregistrement.
            </div>
            <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                <i class="fas fa-save mr-2"></i>Enregistrer les modifications
            </button>
        </div>
    </form>
</div>

<!-- Avertissement de sécurité -->
<div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
    <div class="flex">
        <div class="flex-shrink-0">
            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
        </div>
        <div class="ml-3">
            <h3 class="text-sm font-medium text-yellow-800">Attention - Paramètres sensibles</h3>
            <div class="mt-2 text-sm text-yellow-700">
                <ul class="list-disc list-inside space-y-1">
                    <li>Les paramètres de validation et d'email contiennent des informations sensibles</li>
                    <li>Assurez-vous de changer la clé API de la passerelle en production</li>
                    <li>Le mot de passe SMTP est stocké en clair dans la base de données</li>
                    <li>Activez les cookies sécurisés (HTTPS) en production</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// Gestion des onglets
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');

            // Désactiver tous les onglets
            tabButtons.forEach(btn => {
                btn.classList.remove('border-indigo-600', 'text-indigo-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });

            // Activer l'onglet cliqué
            this.classList.remove('border-transparent', 'text-gray-500');
            this.classList.add('border-indigo-600', 'text-indigo-600');

            // Cacher tous les contenus
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });

            // Afficher le contenu correspondant
            const targetContent = document.querySelector(`[data-tab-content="${targetTab}"]`);
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }
        });
    });
});
</script>
{% endblock %}
